<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U+Bank Travel Portal</title>
    <meta name="description" content="U+Bank Travel Portal - Your gateway to exclusive travel benefits, foreign transaction fee waivers, and dedicated travel support." />
    <!-- Pega Chat Widget Script -->
    <script src="https://widget.use1.chat.pega.digital/e03b7c71-ac8b-4cb4-b890-d813ff3b9074/widget.js"></script>
    <style>
      .splash {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #f5f5f5;
        color: #333;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: Arial, sans-serif;
      }
      .splash img {
        width: 150px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="splash">
        <img src="./img/u+-logo.svg" alt="U+ Bank">
        <div>
          <strong>We're sorry but U+Bank Travel Portal doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.js"></script>

    <!-- Proactive chat trigger that fires after 10 seconds -->
    <script language="javascript">
      // Display an on-screen timer for demonstration
      function showCountdownNotification(seconds, message) {
        // Create or get the notification div
        var notificationDiv = document.getElementById('proactiveChatTimer') || document.createElement('div');
        notificationDiv.id = 'proactiveChatTimer';
        notificationDiv.style.position = 'fixed';
        notificationDiv.style.bottom = '20px';
        notificationDiv.style.right = '20px';
        notificationDiv.style.padding = '10px';
        notificationDiv.style.background = 'rgba(0,0,0,0.7)';
        notificationDiv.style.color = 'white';
        notificationDiv.style.borderRadius = '5px';
        notificationDiv.style.zIndex = '9999';
        notificationDiv.style.fontSize = '14px';
        notificationDiv.style.fontFamily = 'Arial, sans-serif';
        notificationDiv.textContent = message || `Proactive chat will trigger in ${seconds} seconds`;

        if (!document.getElementById('proactiveChatTimer')) {
          document.body.appendChild(notificationDiv);
        }

        return notificationDiv;
      }

      // Initialize variables for timer
      console.log("üïí TimeOnTravelPage trigger script loaded");
      let startTime = Date.now();
      let timeElapsed = 0;
      let timerNotification;

      // Create a countdown timer that updates every second
      const timerInterval = setInterval(function() {
        timeElapsed = Math.floor((Date.now() - startTime) / 1000);
        const remainingSeconds = 10 - timeElapsed;

        if (remainingSeconds >= 0) {
          console.log(`üïí TimeOnTravelPage trigger: ${remainingSeconds} seconds remaining`);
          timerNotification = showCountdownNotification(remainingSeconds);
        }

        // When countdown reaches zero, trigger the chat
        if (timeElapsed >= 10) {
          clearInterval(timerInterval);
          console.log('üöÄ Executing proactive chat trigger: TimeOnTravelPage');

          if (window.PegaUnifiedChatWidget && typeof window.PegaUnifiedChatWidget.triggerChat === 'function') {
            try {
              window.PegaUnifiedChatWidget.triggerChat("TimeOnTravelPage");
              showCountdownNotification(0, "Proactive chat triggered: TimeOnTravelPage");
              console.log('‚úÖ Successfully triggered TimeOnTravelPage chat');
            } catch(e) {
              console.error("‚ùå Error triggering chat:", e);
              showCountdownNotification(0, "Error triggering chat: " + e.message);
            }
          } else {
            console.error("‚ùå PegaUnifiedChatWidget not available");
            showCountdownNotification(0, "Widget not available for trigger");
          }

          // Remove the notification after 5 more seconds
          setTimeout(function() {
            if (timerNotification && timerNotification.parentNode) {
              timerNotification.parentNode.removeChild(timerNotification);
            }
          }, 5000);
        }
      }, 1000);

      // Also listen for the widget loaded event in case timing is important
      document.addEventListener("PegaChatWidget:Loaded", function() {
        console.log("üì± PegaChatWidget:Loaded event received, countdown continues");
      });
    </script>
  </body>
</html>
