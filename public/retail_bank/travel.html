<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U+Bank Travel Portal</title>
    <meta name="description" content="U+Bank Travel Portal - Your gateway to exclusive travel benefits, foreign transaction fee waivers, and dedicated travel support." />
    <!-- Pega Chat Widget Script -->
    <script src="https://widget.use1.chat.pega.digital/e03b7c71-ac8b-4cb4-b890-d813ff3b9074/widget.js"></script>
    <style>
      .splash {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #f5f5f5;
        color: #333;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: Arial, sans-serif;
      }
      .splash img {
        width: 150px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="splash">
        <img src="./img/u+-logo.svg" alt="U+ Bank">
        <div>
          <strong>We're sorry but U+Bank Travel Portal doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.js"></script>

    <!-- UPDATED: Proactive chat trigger that fires after 10 seconds -->
    <script>
      // Immediately register this function to run after the page is loaded
      console.log("üöÄ TimeOnTravelPage trigger script loaded - UPDATED VERSION");

      // Display an on-screen timer for demonstration
      function showCountdownNotification(seconds, message) {
        console.log(`Creating notification: ${message || 'Countdown: ' + seconds}`);

        // Create or get the notification div
        var notificationDiv = document.getElementById('proactiveChatTimer') || document.createElement('div');
        notificationDiv.id = 'proactiveChatTimer';
        notificationDiv.style.position = 'fixed';
        notificationDiv.style.bottom = '20px';
        notificationDiv.style.right = '20px';
        notificationDiv.style.padding = '15px';
        notificationDiv.style.background = 'rgba(0,0,0,0.8)';
        notificationDiv.style.color = 'white';
        notificationDiv.style.borderRadius = '8px';
        notificationDiv.style.zIndex = '999999';
        notificationDiv.style.fontSize = '16px';
        notificationDiv.style.fontFamily = 'Arial, sans-serif';
        notificationDiv.style.border = '2px solid #3C8712';
        notificationDiv.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        notificationDiv.textContent = message || `Proactive chat trigger in ${seconds} seconds`;

        if (!document.getElementById('proactiveChatTimer')) {
          console.log('Appending timer notification to body');
          document.body.appendChild(notificationDiv);
        }

        return notificationDiv;
      }

      // Main function to handle the proactive chat trigger
      function startProactiveTrigger() {
        console.log('‚è±Ô∏è Starting TimeOnTravelPage proactive trigger countdown');

        // Show initial notification immediately
        showCountdownNotification(10, "TimeOnTravelPage trigger in 10 seconds");

        // Track start time
        let startTime = Date.now();
        let timeElapsed = 0;
        let timerNotification;

        // Create a countdown timer that updates every second
        const timerInterval = setInterval(function() {
          timeElapsed = Math.floor((Date.now() - startTime) / 1000);
          const remainingSeconds = 10 - timeElapsed;

          if (remainingSeconds >= 0) {
            console.log(`‚è±Ô∏è TimeOnTravelPage trigger countdown: ${remainingSeconds} seconds remaining`);
            timerNotification = showCountdownNotification(remainingSeconds);
          }

          // When countdown reaches zero, trigger the chat
          if (timeElapsed >= 10) {
            clearInterval(timerInterval);
            console.log('üîî EXECUTING proactive chat trigger: TimeOnTravelPage');

            // Check if widget exists and trigger the chat
            if (window.PegaUnifiedChatWidget && typeof window.PegaUnifiedChatWidget.triggerChat === 'function') {
              try {
                // Add a visible notification
                const triggerNotification = showCountdownNotification(0, "‚ö° FIRING TimeOnTravelPage trigger NOW ‚ö°");

                // Actually trigger the chat
                window.PegaUnifiedChatWidget.triggerChat("TimeOnTravelPage");
                console.log('‚úÖ Successfully triggered TimeOnTravelPage chat');

                // Update the notification
                setTimeout(function() {
                  triggerNotification.textContent = "‚úÖ TimeOnTravelPage trigger executed!";

                  // Remove notification after a few seconds
                  setTimeout(function() {
                    if (triggerNotification && triggerNotification.parentNode) {
                      triggerNotification.parentNode.removeChild(triggerNotification);
                    }
                  }, 5000);
                }, 1000);
              } catch(e) {
                console.error("‚ùå Error triggering chat:", e);
                showCountdownNotification(0, "‚ùå Error: " + e.message);
              }
            } else {
              console.error("‚ùå PegaUnifiedChatWidget not available or triggerChat is not a function");
              console.log("Widget status:", window.PegaUnifiedChatWidget ? "Exists" : "Missing");
              if (window.PegaUnifiedChatWidget) {
                console.log("Available methods:", Object.keys(window.PegaUnifiedChatWidget));
              }
              showCountdownNotification(0, "‚ùå Error: Widget not ready");
            }
          }
        }, 1000);
      }

      // Function to check if Pega widget is loaded
      function checkPegaWidgetAndStart() {
        console.log("Checking if Pega widget is loaded...");
        if (window.PegaUnifiedChatWidget) {
          console.log("‚úÖ PegaUnifiedChatWidget found, starting countdown");
          startProactiveTrigger();
        } else {
          console.log("‚è≥ PegaUnifiedChatWidget not found yet, waiting...");
          // Check again in 1 second
          setTimeout(checkPegaWidgetAndStart, 1000);
        }
      }

      // Start checking once DOM is loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          console.log("DOM loaded, waiting 1 second for widget initialization");
          setTimeout(checkPegaWidgetAndStart, 1000);
        });
      } else {
        console.log("DOM already loaded, waiting 1 second for widget initialization");
        setTimeout(checkPegaWidgetAndStart, 1000);
      }

      // Also listen for the widget loaded event
      document.addEventListener("PegaChatWidget:Loaded", function() {
        console.log("üì± PegaChatWidget:Loaded event received");
        // Let's directly start the trigger if this event fires and we haven't started yet
        if (!window.proactiveTriggerStarted) {
          window.proactiveTriggerStarted = true;
          console.log("Starting trigger from loaded event");
          startProactiveTrigger();
        }
      });

      // Global function to manually trigger (can be called from console for testing)
      window.triggerTimeOnTravelPage = function() {
        console.log("üîî Manually triggering TimeOnTravelPage");
        if (window.PegaUnifiedChatWidget && typeof window.PegaUnifiedChatWidget.triggerChat === 'function') {
          window.PegaUnifiedChatWidget.triggerChat("TimeOnTravelPage");
          return "Trigger sent!";
        } else {
          console.error("Widget not available");
          return "Widget not available";
        }
      };
    </script>
  </body>
</html>
